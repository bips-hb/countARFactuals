---
title: "Other types of models"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to counterfactuals}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

In the following, we explain the `counterfactuals` workflow for both a classification and a regression task using
concrete use cases.

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  fig.width = 7,
  fig.height = 3,
  comment = "#>"
)
options(width = 200)
```

```{r pkg, message=FALSE}
library("counterfactuals")
library("iml")
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Other types of models

The `Predictor` class of the `iml` package provides the necessary flexibility 
to cover classification and regression models fitted with diverse R packages. 
In the introduction vignette, we saw models fitted with the `mlr3` and `randomForest` packages.
In the following, we show extensions to - an AdaBoost classification tree fitted with 
the `caret` package, a classifcation tree fitted with `mlr` and linear regression model 
by `tidymodels`. 
For each model we generate counterfactuals for the first row of the iris dataset 
using the `WhatIf` method 

```{r}
x_interest = iris[1L,]
iris = iris[-1L,]
```


## AdaBoost - caret package
```{r}
library("caret")
ada = train(Species ~ ., data = iris, method = "rpart")
predada = Predictor$new(model = ada, data = iris, y = "Species", type = "prob")
predada$predict(x_interest)
whatifada = WhatIfClassif$new(predictor = predada, n_counterfactuals = 1L)
whatifada$find_counterfactuals(x_interest = x_interest, desired_class = "versicolor", desired_prob = c(.5, 1))
```

## Classification tree - mlr package 
```{r}
library("mlr")
task = mlr::makeClassifTask(data = iris, target = "Species")
mod = makeLearner("classif.rpart", predict.type = "prob")
rpar = train(mod, task)
predrpar = Predictor$new(model = rpar, data = iris, y = "Species", type = "prob")
predrpar$predict(x_interest)
whatifada = WhatIfClassif$new(predictor = predrpar, n_counterfactuals = 1L)
whatifada$find_counterfactuals(x_interest = x_interest, desired_class = "versicolor", desired_prob = c(.5, 1))
```


## Linear regression model - tidymodels package
```{r}
library("tidymodels")
dt_mod = decision_tree(mode = "classification")
dt_fit = dt_mod %>% fit(Species ~ ., data = iris)
preddt = Predictor$new(model = dt_fit, data = iris, y = "Species", type = "prob", 
  predict.function = function(model, newdata) {
    p = predict(model, newdata, type = "prob")
    names(p) = gsub(pattern = ".pred_", replacement = "", x = names(p))
    p
  })
preddt$predict(x_interest)
whatifdt = WhatIfClassif$new(predictor = preddt, n_counterfactuals = 1L)
whatifdt$find_counterfactuals(x_interest = x_interest, desired_class = "versicolor", desired_prob = c(.5, 1))
```

